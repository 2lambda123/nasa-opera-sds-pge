# Sample RunConfig for use with the DSWx-S1 PGE
# This RunConfig should require minimal changes in order to be used with the
# OPERA PCM.

RunConfig:
    # Name for the RunConfig, may be any string
    Name: OPERA-DSWX-S1-PGE-SAMPLE-CONFIG

    Groups:
        # PGE-specific RunConfig section
        # This section is only used by the PGE, however, paths to inputs/outputs
        # should align with the similar sections of the SAS RunConfig
        PGE:
            PGENameGroup:
                # Name of the PGE for use with this RunConfig, should always be
                # DSWX_S1_PGE when using with the DSWx-S1 PGE
                PGEName: DSWX_S1_PGE

            InputFilesGroup:
                # List of input files/directories
                # Must be a list of directories, each containing data from a single RTC burst
                # For each burst there will be .tif file/s and an associated .h5 metadata file.

                InputFilePaths: [
                  /home/conda/input_dir/rtc_data/t047_100908_iw3,
                  /home/conda/input_dir/rtc_data/t047_100909_iw1,
                  /home/conda/input_dir/rtc_data/t047_100909_iw2,
                  /home/conda/input_dir/rtc_data/t047_100909_iw3,
                  /home/conda/input_dir/rtc_data/t047_100910_iw1,
                  /home/conda/input_dir/rtc_data/t047_100910_iw2,
                  /home/conda/input_dir/rtc_data/t047_100910_iw3
                ]

            DynamicAncillaryFilesGroup:
                # Map of ancillary file types to paths to the file
                # Paths must correspond to the file system within the Docker container
                AncillaryFileMap:
                    # Path to the Digital Elevation Model
                    # Must be either a single .tif, or a .vrt that points to one
                    # or more .tif files
                    dem_file: /home/conda/input_dir/ancillary_data/dem.tif

                    # Path to the Discrete Classification Map
                    # Must point to a single .tif file
                    hand_file: /home/conda/input_dir/ancillary_data/hand.tif

                    reference_water_file: /home/conda/input_dir/ancillary_data/reference_water.tif

                    world_cover: /home/conda/input_dir/ancillary_data/worldcover.tif

            ProductPathGroup:
                # Path to where output products should be stored
                # Must correspond to the file system within the Docker container,
                # and must have write permissions for the User/Group used with
                # the "Docker run" command
                OutputProductPath: /home/conda/output_dir

                # Path to a scratch directory for the PGE and SAS to store
                # intermediate files that will not be needed after PGE execution
                # completes
                # Must correspond to the file system within the Docker container,
                # and must have write permissions for the User/Group used with
                # the "Docker run" command
                ScratchPath: /home/conda/output_dir/scratch_dir

            PrimaryExecutable:
                # Identifier for the PGE executable, should always be DSWX_HLS for
                # this PGE
                ProductIdentifier: DSWX_S1

                # Product version specific to output products
                ProductVersion: 1.0

                # Path to the executable to run, path must be reachable from
                # within the Docker container (i.e. findable with a "which" command)
                ProgramPath: python3

                # List of command-line options to use with ProgramPath
                ProgramOptions:
                    - /home/conda/dswx-s1-0.1.0/src/dswx_sar/dswx_s1.py
                # TODO - the comment below will be removed when the option becomes available
                #    - --full-log-format

                # The Error Code base value added to the offset values to make
                # error codes unique per-PGE
                ErrorCodeBase: 400000

                # Path to the Yamale schema used to validate the SAS portion
                # of the RunConfig
                # Path should correspond to the file system within the Docker
                # container, and typically should reference a schema file bundled
                # with the opera_pge installation directory within the container
                # Consult the Docker image build scripts for more info
                SchemaPath: /home/conda/opera/pge/dswx_s1/schema/dswx_s1_sas_schema.yaml

                AlgorithmParametersSchemaPath: /home/conda/opera/pge/dswx_s1/schema/algorithm_parameters_s1_schema.yaml

                # Path to the Jinja2 template used to generate the ISO xml
                # metadata file
                # Path should correspond to the file system within the Docker
                # container, and typically should reference a template file bundled
                # with the opera_pge installation directory within the container
                # Consult the Docker image build scripts for more info
                # TODO - This template does not exist yet, so the field is left blank
                IsoTemplatePath:

            QAExecutable:
                # Set to True to enable execution of an additional "Quality Assurance"
                # application after SAS execution has completed
                Enabled: False

                # Path to the executable to run, path must be reachable from
                # within the Docker container (i.e. findable with a "which" command)
                ProgramPath:

                # List of command-line options to use with ProgramPath
                ProgramOptions:

            DebugLevelGroup:
                # Set to True to enable Debug mode (TODO this is currently a no-op)
                DebugSwitch: False

                # Set to True to have the PGE invoke the SAS/QA executables via
                # a shell, rather than a Python subprocess
                # This allows shell-style syntax to be used in ProgramPath and
                # ProgramOptions, which can be useful for testing
                ExecuteViaShell: False

        # SAS-specific RunConfig section
        # Prior to SAS execution by the PGE, the section below starting at "runconfig"
        # is isolated into its own YAML file for use with the SAS
        SAS:
          runconfig:
            name: dswx_s1_workflow_default

            groups:
              pge_name_group:
                pge_name: DSWX_S1_PGE

              input_file_group:
                # REQUIRED - Single S1 RTC geotiff or
                #            multiple burst RTC directory containing
                #            hdf5 metadata and rtc geotiff (directory or files)
                #            for open water
                input_file_path: [
                  /home/conda/input_dir/rtc_data/t047_100908_iw3,
                  /home/conda/input_dir/rtc_data/t047_100909_iw1,
                  /home/conda/input_dir/rtc_data/t047_100909_iw2,
                  /home/conda/input_dir/rtc_data/t047_100909_iw3,
                  /home/conda/input_dir/rtc_data/t047_100910_iw1,
                  /home/conda/input_dir/rtc_data/t047_100910_iw2,
                  /home/conda/input_dir/rtc_data/t047_100910_iw3
                ]
              dynamic_ancillary_file_group:
                # Digital elevation model (Required)
                dem_file: /home/conda/input_dir/ancillary_data/dem.tif

                # Digital elevation model source description
                dem_file_description: 'DEM'

                # ESA WorldCover map file
                # (Required for opera_dswx_s1)
                world_file: /home/conda/input_dir/ancillary_data/worldcover.tif

                # ESA WorldCover map description
                worldcover_file_description: 'COPERNICUS WORLDCOVER 10m'

                # Reference water body map (Required)
                # e.g., Pekel's water occurrence or seasonality map
                reference_water_file: /home/conda/input_dir/ancillary_data/reference_water.tif

                # Reference water description
                reference_water_file_description: 'PEKELs water'

                # Height Above Nearest Drainage (Required)
                hand_file: /home/conda/input_dir/ancillary_data/hand.tif

                # HAND description
                hand_file_description: 'ASF HAND'

                # NOAA GSHHS shapefile (optional)
                shoreline_shapefile:

                # NOAA GSHHS shapefile description
                shoreline_shapefile_description:

                # Separate runconfig file for algorithm parameters
                algorithm_parameters: /home/conda/input_dir/ancillary_data/algorithm_parameter_s1.yaml

              primary_executable:
                product_type: dswx_s1

              product_path_group:
                # Directory where PGE will place results
                product_path: /home/conda/output_dir

                # Directory where SAS can write temporary data
                scratch_path: /home/conda/output_dir/scratch_dir

                # SAS writes the output product to the following file.
                # the scheme:
                # {output_dir}/{product_id}_v{product_version}_B{layer_number}_{layer_name}.tif
                # The default value for `product_id` is "dswx_hls".
                # The default value for `product_version` is the PROTEUS software version.
                # `layer_number` and `layer_name` are automatically set by the DSWx-HLS SAS
                # The PGE should update `product_id` and `product_version`
                sas_output_path: /home/conda/output_dir
                product_id: OPERA_L3_DSWx-S1
                product_version: 0.1

              log_file:
