# Sample RunConfig for use with the DISP-S1 PGE v3.0.0-er.4.0
# This RunConfig should require minimal changes in order to be used with the
# OPERA PCM.

RunConfig:
    # Name for the RunConfig, may be any string
    Name: OPERA-DISP-S1-PGE-SAMPLE-CONFIG

    Groups:
        # PGE-specific RunConfig section
        # This section is only used by the PGE, however, paths to inputs/outputs
        # should align with the similar sections of the SAS RunConfig
        PGE:
            PGENameGroup:
                # Name of the PGE for use with this RunConfig, should always be
                # DISP_S1_PGE when using with the DISP-S1 PGE
                PGEName: DISP_S1_PGE

            InputFilesGroup:
                # List of input files
                # Must be a list containing the path to the input CSLC-S1 products,
                # as well as the paths to any compressed CSLC-S1 products.
                # Paths must correspond to the file system within the Docker container
                InputFilePaths:
                    - /home/mamba/input_dir/input_slcs/compressed_slc_t087_185683_iw2_20180101_20180210.h5
                    - /home/mamba/input_dir/input_slcs/t087_185683_iw2_20180222_VV.h5
                    - /home/mamba/input_dir/input_slcs/t087_185683_iw2_20180306_VV.h5
                    - /home/mamba/input_dir/input_slcs/t087_185683_iw2_20180318_VV.h5
                    - /home/mamba/input_dir/input_slcs/t087_185683_iw2_20180330_VV.h5
                    - /home/mamba/input_dir/input_slcs/compressed_slc_t087_185684_iw2_20180101_20180210.h5
                    - /home/mamba/input_dir/input_slcs/t087_185684_iw2_20180222_VV.h5
                    - /home/mamba/input_dir/input_slcs/t087_185684_iw2_20180306_VV.h5
                    - /home/mamba/input_dir/input_slcs/t087_185684_iw2_20180318_VV.h5
                    - /home/mamba/input_dir/input_slcs/t087_185684_iw2_20180330_VV.h5

            DynamicAncillaryFilesGroup:
                # Map of ancillary file types to paths to the file
                # Paths must correspond to the file system within the Docker container
                AncillaryFileMap:
                    # Path to the Digital Elevation Model
                    # Must be either a single .tif, or a .vrt that points to one
                    # or more .tif files
                    dem_file: /home/mamba/input_dir/dynamic_ancillary/dem.tif

            ProductPathGroup:
                # Path to where output products should be stored
                # Must correspond to the file system within the Docker container,
                # and must have write permissions for the User/Group used with
                # the "Docker run" command
                OutputProductPath: /home/mamba/output_dir

                # Path to a scratch directory for the PGE and SAS to store
                # intermediate files that will not be needed after PGE execution
                # completes
                # Must correspond to the file system within the Docker container,
                # and must have write permissions for the User/Group used with
                # the "Docker run" command
                ScratchPath: /home/mamba/scratch_dir

            PrimaryExecutable:
                # Identifier for the PGE executable, should always be DISP_S1 for
                # this PGE
                ProductIdentifier: DISP_S1

                # Product version specific to output products
                ProductVersion: "0.1"

                # Path to the executable to run, path must be reachable from
                # within the Docker container (i.e. findable with a "which" command)
                ProgramPath: dolphin

                # List of command-line options to use with ProgramPath
                ProgramOptions:
                    - run
                    - --pge

                # The Error Code base value added to the offset values to make
                # error codes unique per-PGE
                ErrorCodeBase: 500000

                # Path to the Yamale schema used to validate the SAS portion
                # of the RunConfig
                # Path should correspond to the file system within the Docker
                # container, and typically should reference a schema file bundled
                # with the opera_pge installation directory within the container
                # Consult the Docker image build scripts for more info
                SchemaPath: /home/mamba/opera/pge/disp_s1/schema/disp_s1_sas_schema.yaml

                # Path to the Yamale schema used specifically to validate the
                # algorithm parameters config, which is stored within a separate
                # yaml file referenced within the SAS portion of this RunConfig
                AlgorithmParametersSchemaPath: /home/mamba/opera/pge/disp_s1/schema/algor_param_disp_s1_schema.yaml

                # Path to the Jinja2 template used to generate the ISO xml
                # metadata file
                # Path should correspond to the file system within the Docker
                # container, and typically should reference a template file bundled
                # with the opera_pge installation directory within the container
                # Consult the Docker image build scripts for more info
                IsoTemplatePath: /home/mamba/opera/pge/disp_s1/templates/OPERA_ISO_metadata_L3_DISP_S1_template.xml.jinja2

            QAExecutable:
                # Set to True to enable execution of an additional "Quality Assurance"
                # application after SAS execution has completed
                Enabled: False

                # Path to the executable to run, path must be reachable from
                # within the Docker container (i.e. findable with a "which" command)
                ProgramPath:

                # List of command-line options to use with ProgramPath
                ProgramOptions: []

            DebugLevelGroup:
                # Set to True to enable Debug mode (TODO this is currently a no-op)
                DebugSwitch: False

                # Set to True to have the PGE invoke the SAS/QA executables via
                # a shell, rather than a Python subprocess
                # This allows shell-style syntax to be used in ProgramPath and
                # ProgramOptions, which can be useful for testing
                ExecuteViaShell: False

        # SAS-specific RunConfig section
        # Prior to SAS execution by the PGE, the section below starting at "input_file_group"
        # is isolated into its own YAML file for use with the SAS
        SAS:
            input_file_group:
                # REQUIRED: List of paths to CSLC files.
                #   Type: array.
                cslc_file_list:
                  - /home/mamba/input_dir/input_slcs/compressed_slc_t087_185683_iw2_20180101_20180210.h5
                  - /home/mamba/input_dir/input_slcs/t087_185683_iw2_20180222_VV.h5
                  - /home/mamba/input_dir/input_slcs/t087_185683_iw2_20180306_VV.h5
                  - /home/mamba/input_dir/input_slcs/t087_185683_iw2_20180318_VV.h5
                  - /home/mamba/input_dir/input_slcs/t087_185683_iw2_20180330_VV.h5
                  - /home/mamba/input_dir/input_slcs/compressed_slc_t087_185684_iw2_20180101_20180210.h5
                  - /home/mamba/input_dir/input_slcs/t087_185684_iw2_20180222_VV.h5
                  - /home/mamba/input_dir/input_slcs/t087_185684_iw2_20180306_VV.h5
                  - /home/mamba/input_dir/input_slcs/t087_185684_iw2_20180318_VV.h5
                  - /home/mamba/input_dir/input_slcs/t087_185684_iw2_20180330_VV.h5

                # REQUIRED: Frame ID of the bursts contained in `cslc_file_list`.
                #   Type: integer.
                frame_id: 123
            dynamic_ancillary_file_group:
                # REQUIRED: Path to file containing SAS algorithm parameters.
                #   Type: string.
                algorithm_parameters_file: /home/mamba/input_dir/algorithm_parameters.yaml
                # Paths to existing Amplitude Dispersion file (1 per burst) for PS update calculation.
                #   Type: array.
                amplitude_dispersion_files:
                  - /home/mamba/input_dir/dynamic_ancillary/ps_files/t087_185683_iw2_amp_dispersion.tif
                  - /home/mamba/input_dir/dynamic_ancillary/ps_files/t087_185684_iw2_amp_dispersion.tif
                # Paths to an existing Amplitude Mean files (1 per burst) for PS update calculation.
                #   Type: array.
                amplitude_mean_files:
                  - /home/mamba/input_dir/dynamic_ancillary/ps_files/t087_185683_iw2_amp_mean.tif
                  - /home/mamba/input_dir/dynamic_ancillary/ps_files/t087_185684_iw2_amp_mean.tif
                # Paths to the incidence/azimuth-angle files (1 per burst).
                #   Type: array.
                geometry_files:
                  - /home/mamba/input_dir/dynamic_ancillary/geometry_files/t087_185683_iw2_topo.h5
                  - /home/mamba/input_dir/dynamic_ancillary/geometry_files/t087_185684_iw2_topo.h5
                # Mask files (e.g water mask), where convention is 0 for no data/invalid, and 1 for
                #   data.
                #   Type: array.
                mask_file: /home/mamba/input_dir/dynamic_ancillary/water_mask.tif
                # Path to the DEM file covering full frame.
                #   Type: string.
                dem_file: /home/mamba/input_dir/dynamic_ancillary/dem.tif
                # List of Paths to TEC files in IONEX format for ionosphere correction.
                #   Type: string.
                tec_files:
                  - /home/mamba/input_dir/dynamic_ancillary/jplg0410.18i.Z
                  - /home/mamba/input_dir/dynamic_ancillary/jplg1970.18i.Z
                # List of Paths to troposphere weather model files.
                #   Type: string.
                weather_model_files:
                  - /home/mamba/input_dir/dynamic_ancillary/GMAO_tropo_20180210T000000_ztd.nc
                  - /home/mamba/input_dir/dynamic_ancillary/GMAO_tropo_20180716T000000_ztd.nc
            primary_executable:
                # Product type of the PGE.
                #   Type: string.
                product_type: DISP_S1_SINGLE
            product_path_group:
                # REQUIRED: Directory where PGE will place results.
                #   Type: string.
                product_path: /home/mamba/output_dir
                # Path to the scratch directory.
                #   Type: string.
                scratch_path: /home/mamba/scratch_dir
                # Path to the SAS output directory.
                #   Type: string.
                sas_output_path: /home/mamba/output_dir
                # Version of the product.
                #   Type: string.
                product_version: "0.1"
                # Whether the SAS should output and save the Compressed SLCs in addition to the standard
                #   product output.
                #   Type: boolean.
                save_compressed_slc: true
            worker_settings:
                # Whether to use GPU for processing (if available).
                #   Type: boolean.
                gpu_enabled: true
                # (For non-GPU) Number of cpu cores to use for processing. Uses
                #   `multiprocessing.cpu_count()` if not set.
                #   Type: integer.
                n_workers: 32
                # Number of threads to use per worker. This sets the OMP_NUM_THREADS environment variable.
                #   Type: integer.
                threads_per_worker: 2
                # Size (in GB) of blocks of data to load at a time.
                #   Type: number.
                block_size_gb: 1.0
            # Path to the output log file in addition to logging to stderr.
            #   Type: string.
            log_file: /home/mamba/output_dir/sas_logfile.log
